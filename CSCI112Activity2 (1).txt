//create database
use apple;

//validations
db.createCollection("ipads", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: [ "model", "generation", "yearReleased", "homeButton", "colors", "retailPricePHP", "applePencilSupport", "chargingPort", "baseStorageSize" ],
         properties: {
            model: {
               bsonType: "string",
               description: "Must be a string. Required"
            },
            generation: {
               bsonType: "string",
               description: "Must be a string. Requiredd"
            },
            yearReleased: {
               bsonType: "int",
               description: "Must be an integer. Required."
            },
            homeButton: {
               bsonType: "bool",
               description: "Must be a boolean. Required."
            },
            colors: {
               bsonType: "array",
               items: ["string"],
               description: "Is an array. Must be strings. Required."
            },
            retailPricePHP: {
               bsonType: "int",
               description: "Must be an integer. Required."
            },
            applePencilSupport: {
               bsonType: "bool",
               description: "Must be a boolean. Required."
            },
            chargingPort: {
               bsonType: "string",
               description: "Must be a string. Required."
            },
            baseStorageSize: {
               bsonType: ["int"],
               description: "Is an array. Must be an integer. Units is in GB. Required. "
            }
         }
      }
   },
});

//create documents and collections
db.ipads.insertMany([
    {model: "iPad", generation: "1st", yearReleased: 2010, homeButton: true, colors: ["Black"], retailPricePHP: 23990, applePencilSupport: false, chargingPort: "30-pin", baseStorageSize: [16,32,64], slogan: "A magical and revolutionary device at an unbelievable price."},
    {model: "iPad", generation: "2nd", yearReleased: 2011, homeButton: true, colors: ["Black", "White"], retailPricePHP: 23990, applePencilSupport: false, chargingPort: "30-pin", baseStorageSize: [16,32,64], slogan: "Thinner. Lighter. Faster. FaceTime."},
    {model: "iPad", generation: "3rd", yearReleased: 2012, homeButton: true, colors: ["Black", "White"], retailPricePHP: 23990, applePencilSupport: false, chargingPort: "30-pin", baseStorageSize: [16,32,64], slogan: "Resolutionary."},
    {model: "iPad", generation: "4th", yearReleased: 2012, homeButton: true, colors: ["Black", "White"], retailPricePHP: 23966, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,32,64], slogan: "Just as stunning. Twice as fast."},
    {model: "iPad", generation: "5th", yearReleased: 2017, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 18990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128], slogan: "Flat-out fun."},
    {model: "iPad", generation: "6th", yearReleased: 2018, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 20990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128], slogan: "Create, learn, work, and play like never before."},
    {model: "iPad", generation: "7th", yearReleased: 2019, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 19990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128], slogan: "Like a computer. Unlike any computer."},
    {model: "iPad", generation: "8th", yearReleased: 2020, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 15990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128], slogan: "Delightfully capable. Surprisingly affordable."},
    {model: "iPad", generation: "9th", yearReleased: 2021, homeButton: true, colors: ["Silver", "Space Gray"], retailPricePHP: 21990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [64,256], slogan: "Easy does it all."},
    {model: "iPad", generation: "10th", yearReleased: 2022, homeButton: false, colors: ["Blue","Pink","Yellow","Silver"], retailPricePHP: 29990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [64,256], slogan: "Lovable. Drawable. Magical."},
    {model: "iPad Air", generation: "1st", yearReleased: 2013, homeButton: true, colors: ["Silver", "Space Gray"], retailPricePHP: 23580, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,32,64,128], slogan: "Power is not just for the pros."},
    {model: "iPad Air", generation: "2nd", yearReleased: 2014, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 25490, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,64,128], slogan: "Change is in the Air."},
    {model: "iPad Air", generation: "3rd", yearReleased: 2019, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 26490, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [64,256], slogan: "N/A"},
    {model: "iPad Air", generation: "4th", yearReleased: 2020, homeButton: false, colors: ["Starlight", "Space Gray", "Pink", "Purple", "Blue"], retailPricePHP: 3990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [64,256], slogan: "Light. Bright. Full of might."},
    {model: "iPad Mini", generation: "1st", yearReleased: 2012, homeButton: true, colors: ["Black/Slate", "White/Silver"], retailPricePHP: 15990, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,32,64], slogan: "Every inch an iPad."},
    {model: "iPad Mini", generation: "2nd", yearReleased: 2013, homeButton: true, colors: ["Space Gray", "Silver"], retailPricePHP: 20490, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,32,64,128], slogan: "Small wonder."},
    {model: "iPad Mini", generation: "3rd", yearReleased: 2014, homeButton: true, colors: ["Space Gray", "Silver", "Gold"], retailPricePHP: 20490, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,64,128], slogan: "N/A"},
    {model: "iPad Mini", generation: "4th", yearReleased: 2015, homeButton: true, colors: ["Space Gray", "Silver", "Gold"], retailPricePHP: 20990, applePencilSupport: false, chargingPort: "Lightning", baseStorageSize: [16,64,128], slogan: "Mighty. Small."},
    {model: "iPad Mini", generation: "5th", yearReleased: 2019, homeButton: true, colors: ["Space Gray", "Silver", "Gold"], retailPricePHP: 20990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [64,256], slogan: "Mini just got mightier."},
    {model: "iPad Mini", generation: "6th", yearReleased: 2021, homeButton: false, colors: ["Pink", "Starlight", "Purple", "Space Gray"], retailPricePHP: 32990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [64,256], slogan: "Mega power. Mini sized."},
    {model: "iPad Pro", generation: "1st", yearReleased: 2015, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 42990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128], slogan: "The biggest thing in iPads since iPad."},
    {model: "iPad Pro", generation: "2nd", yearReleased: 2016, homeButton: true, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 32990, applePencilSupport: true, chargingPort: "Lightning", baseStorageSize: [32,128,256], slogan: "Anything you can do, you can do better."},
    {model: "iPad Pro", generation: "3rd", yearReleased: 2018, homeButton: false, colors: ["Silver", "Space Gray"], retailPricePHP: 51990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [64,256,512,1000], slogan: "Everything has changed."},
    {model: "iPad Pro", generation: "4th", yearReleased: 2020, homeButton: false, colors: ["Silver", "Space Gray"], retailPricePHP: 47990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [128,256,512,1000], slogan: "Your next computer is not a computer."},
    {model: "iPad Pro", generation: "5th", yearReleased: 2022, homeButton: false, colors: ["Silver", "Space Gray", "Gold"], retailPricePHP: 55990, applePencilSupport: true, chargingPort: "USB-C", baseStorageSize: [128,256,512,1000,2000], slogan: "M2 chip. Next-generation performance."}
]);

// Group all iPads introduced without the home button.

db.ipads.aggregate([
  {
    $match: {
      homeButton: false,
      model: { $nin: ["iPad Pro", "iPad Air", "iPad Mini"] }
    }
  },
  {
    $group: {
      _id: null,
      iPadsWithoutHomeButton: {
        $push: {
          model: "$model",
          generation: "$generation",
          yearReleased: "$yearReleased",
          colors: "$colors",
          retailPricePHP: "$retailPricePHP",
          applePencilSupport: "$applePencilSupport",
          chargingPort: "$chargingPort",
          baseStorageSize: "$baseStorageSize",
          slogan: "$slogan"
        }
      }
    }
  }
]);



// Using aggregate, find the latest iPad released, not a Pro, Air, Mini. Limit to 1.

db.ipads.aggregate([
  {
    $match: {
      model: "iPad",
      generation: { $nin: ["Pro", "Air", "Mini"] }
    }
  },
  {
    $sort: {
      yearReleased: -1
    }
  },
  {
    $limit: 1
  }
]);



//Using project, display all iPad with Apple Pencil capability. Show only iPad Model, Year Released, Price, and Colors Available.

db.ipads.aggregate([
    {
        $match: {
            applePencilSupport: true,
            //model: "iPad" 
	    //not sure if i should include above line or not
        }
    },
    {
        $project: {
            _id: 0, // Exclude the default _id field
            model: 1,
            yearReleased: 1,
            retailPricePHP: 1,
            colors: 1
        }
    }
])

//Sort all iPads released from 2010-2015 in descending order.
db.ipads.aggregate([
  {
    $match: {
      yearReleased: { $gte: 2010, $lte: 2015 }
    }
  },
  {
    $sort: {
      yearReleased: -1
    }
  }
]);


//Match all iPads without the lightning cable charger.

db.ipads.find({
    chargingPort: { $ne: "Lightning" }
})

//or
db.ipads.aggregate([
  {
    $match: {
      chargingPort: { $ne: "Lightning" }
    }
  }
]);

//latter makes use of match. former makes use of find only

//projected results
db.ipads.aggregate([
    {
    $match: {
      chargingPort: { $ne: "Lightning" }
    }
  },
    {
        $project: {
            _id: 0, // Exclude the default _id field
            model: 1,
            yearReleased: 1,
            retailPricePHP: 1,
            colors: 1
        }
    }
])

// count all ipads with 64gb as the base model
db.ipads.count({
  "baseStorageSize": 64
})

// finding all ipads with "power" in their slogan
// creating an index
db.ipads.createIndex({ slogan: "text" })

// finding all ipads with power in the slogan
db.ipads.find({ $text: { $search: "power" } })

